#    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù„Ù…Ø·ÙˆØ±ÙŠ Ø³ÙˆØ±Ø³ Ø¯ÙŠÙˆ Ø­ØµØ±ÙŠØ§ Ù„Ù‡Ù… ÙÙ‚Ø·
#    Ø§Ø°Ø§ ØªØ®Ù…Ø· Ø§Ù„Ù…Ù„Ù Ø§Ø°ÙƒØ± Ø§Ù„Ø­Ù‚ÙˆÙ‚ ÙˆÙƒØ§ØªØ¨ÙŠÙ‡ ÙˆÙ…Ø·ÙˆØ±ÙŠÙ‡ Ù„Ø§ ØªØ­Ø°Ù Ø§Ù„Ø­Ù‚ÙˆÙ‚ ÙˆØªØµÙŠØ± ÙØ§Ø´Ù„ ğŸ‘
#    ÙƒØªØ§Ø¨Ø© Ø­Ø³Ù† ÙˆØ¬ÙŠØ±ÙŠ

from telethon.utils import pack_bot_file_id

from userbot import jmthon
from userbot.core.logger import logging

from ..core.managers import edit_delete, edit_or_reply

plugin_category = "utils"

LOGS = logging.getLogger(__name__)


@jmthon.ar_cmd(
    pattern="(Ø§Ù„Ø§ÙŠØ¯ÙŠ|id)(?:\s|$)([\s\S]*)",
    command=("Ø§Ù„Ø§ÙŠØ¯ÙŠ", plugin_category),
    info={
        "header": "To get id of the group or user.",
        "description": "if given input then shows id of that given chat/channel/user else if you reply to user then shows id of the replied user \
    along with current chat id and if not replied to user or given input then just show id of the chat where you used the command",
        "usage": "{tr}id <reply/username>",
    },
)
async def _(event):
    "To get id of the group or user."
    input_str = event.pattern_match.group(2)
    if input_str:
        try:
            p = await event.client.get_entity(input_str)
        except Exception as e:
            return await edit_delete(event, f"`{str(e)}`", 5)
        try:
            if p.first_name:
                return await edit_or_reply(
                    event, f"â™°ï¸™Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… : `{input_str}` Ù‡Ùˆ `{p.id}`"
                )
        except Exception:
            try:
                if p.title:
                    return await edit_or_reply(
                        event, f"â™°ï¸™Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©/Ø§Ù„Ù‚Ù†Ø§Ø© `{p.title}` Ù‡Ùˆ `{p.id}`"
                    )
            except Exception as e:
                LOGS.info(str(e))
        await edit_or_reply(event, "â™°ï¸™ÙŠÙ€Ø¬Ø¨ ÙƒÙ€ØªØ§Ø¨Ø© Ù…Ù€Ø¹Ø±Ù Ø§Ù„Ø´Ù€Ø®Øµ Ø§Ùˆ Ø§Ù„Ù€Ø±Ø¯ Ø¹Ù€Ù„ÙŠÙ‡")
    elif event.reply_to_msg_id:
        await event.get_input_chat()
        r_msg = await event.get_reply_message()
        if r_msg.media:
            bot_api_file_id = pack_bot_file_id(r_msg.media)
            await edit_or_reply(
                event,
                f"â™°ï¸™Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ù‡: `{str(event.chat_id)}` \nâ™°ï¸™Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: `{str(r_msg.sender_id)}` \nâŒ¯ï¸™Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù…ÙŠØ¯ÙŠØ§: `{bot_api_file_id}`",
            )
        else:
            await edit_or_reply(
                event,
                f"â™°ï¸™Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ù‡ : `{str(event.chat_id)}` \nâ™°ï¸™Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… : `{str(r_msg.sender_id)}` ",
            )
    else:
        await edit_or_reply(event, f"â™°ï¸™Ø§Ù„Ù€Ø¯Ø±Ø¯Ø´Ù€Ø© Ø§Ù„Ù€Ø­Ø§Ù„ÙŠØ© : `{str(event.chat_id)}`")
